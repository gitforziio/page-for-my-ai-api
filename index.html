<!DOCTYPE html>
<html lang="en">
<!-- --- -->
<head>
<!-- --- -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI-API</title>
<link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.1/css/bootstrap.min.css" rel="stylesheet">
<!-- --- -->
<style>
.page-cover {
  position: fixed;
  top:0; right:0; bottom:0; left:0;
  overflow: hidden;
  background: #eee;
  z-index: 99999;
}
.pre {
  white-space: pre-wrap;
}
</style>
<!-- --- -->
</head>
<!-- --- -->
<body>
<!-- --- -->
<div class="app" id="app">
<!-- --- -->

<div class="page-cover" v-if="false"><div class="container pt-5 text-center">
  <div class="row"><div><h2>AI-API</h2></div></div>
  <div class="row"><div><p>loading...</p></div></div>
</div></div>


<div class="main-wrap">

  <div class="d-flex flex-column m-2 p-2 gap-2 rounded border text-secondary bg-secondary bg-opacity-10">
    <h5 class="mb-0">ğŸ”‘ <code>SERVER</code></h5>
    <div>backendUrl</div>
    <input type="text" class="form-control" v-model="data.backendUrl" placeholder="http:xxx.com/xx/xx">
    <div>password</div>
    <input type="password" class="form-control" v-model="data.password" placeholder="xxxxxx">
  </div>



  <div class="d-flex flex-column m-2 p-2 gap-2 rounded border text-secondary bg-secondary bg-opacity-10">
    <h5 class="mb-0">ğŸŒ <code>SYSTEM</code></h5>
    <div>You are a helpful assistant designed to output JSON.</div>
    <div>Your task:</div>
    <textarea class="form-control font-monospace" v-model="data.taskDesc" placeholder="åˆ¤æ–­Aå’ŒBæ˜¯å¦æ˜¯è¿‘ä¹‰è¯"></textarea>

    <div>Request format:</div>
    <textarea class="form-control font-monospace" v-model="data.reqFormat" placeholder='{ "A": "å¤©æ‰", "B": "é»„ç“œ" }'></textarea>

    <div>Respond format:</div>
    <textarea class="form-control font-monospace" v-model="data.resFormat" placeholder='{ "Re": false }'></textarea>

    <div>You should use the same language as the users whenever possible.</div>
  </div>


  <div class="d-flex flex-column m-2 p-2 gap-2 rounded border text-secondary bg-secondary bg-opacity-10">
    <h5 class="mb-0">ğŸ™‚ <code>USER</code></h5>
    <div class=""><textarea class="form-control font-monospace" v-model="data.query" placeholder='{ "A": "å¤©æ‰", "B": "é»„ç“œ" }'></textarea></div>
    <div>model:</div>
    <!-- <input type="text" class="form-control" v-model="data.model" placeholder="gpt-3.5-turbo-1106"> -->
    <select v-model="data.model" class="form-select" aria-label="Select your model">
      <option value="gpt-3.5-turbo-1106" selected>gpt-3.5-turbo-1106</option>
      <option value="gpt-4-1106-preview">gpt-4-1106-preview</option>
    </select>

    <div class=""><button :class='`btn -btn-sm btn-primary${data.running?" disabled":""}`' type="button" @click="onRun">{{data.running?"...":"Run"}}</button></div>
  </div>


  <div class="d-flex flex-column m-2 p-2 gap-2 rounded border text-secondary bg-secondary bg-opacity-10">
    <div class=""><button :class='`btn -btn-sm btn-secondary`' type="button" @click="()=>{data.collapsed=!data.collapsed}">{{data.collapsed?"collapsed: on":"collapsed: off"}}</button></div>

    <h5 class="mb-0">ğŸ¤– <code>AGENT</code></h5>
    <pre :class="`pre mb-0 text-break ${data.collapsed?'':'--'}text-wrap`">{{data.result?.data??data.result?.error??(data.running?"Thinking...":":)")}}</pre>
  </div>

</div>


<!-- --- -->
</div>
<!-- --- -->
<script src="https://cdn.bootcdn.net/ajax/libs/axios/1.5.0/axios.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.js"></script>
<!-- <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script> -->
<!-- <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.runtime.global.prod.min.js"></script> -->
<script>

function makeInstruction(task, reqFormat, resFormat) {
  return instructionTemplate.replace("[<[([[TASK_DESCRIPTION]])]>]", task).replace("[<[([[REQ_FORMAT]])]>]", reqFormat).replace("[<[([[RES_FORMAT]])]>]", resFormat);
}

const onMountedFn = async (store, data) => {
  const myStoredData = await store.getItem("myStoredData")??{};
  Object.assign(data, myStoredData);
};

const onUpdatedFn = async (store, data) => {
  const toBeStored = {...data, result: null};
  await store.setItem("myStoredData", toBeStored);
};

const onRunFn = async (data) => {
  data.running = true;
  data.result = null;
  const {
    backendUrl,
    password,
    query,
    model,
    taskDesc: task,
    reqFormat,
    resFormat,
  } = data;
  try {
    if (!task?.length) throw new Error("task is empty");
    if (!query?.length) throw new Error("query is empty");

    const res = await axios.post(data.backendUrl, {
      query,
      task,
      reqFormat,
      resFormat,
      model,
      password,
    });

    console.log(res.data);

    // data.result = res.type=="json" ? JSON.stringify(JSON.parse(res.data), null, 2) : res.data;
    data.result = res.data;
    data.running = false;

  } catch (err) {

    console.error(err);
    data.result = {type: "error", error: err};
    data.running = false;

  }
};

const default_taskDesc = `ä½ æ­£åœ¨è¿›è¡Œè¯æ±‡æ¨ç†èƒ½åŠ›æµ‹è¯•ã€‚
- é¢˜ç›®ï¼ˆQï¼‰ä¼šç»™å‡ºè‹¥å¹²å«æœ‰ _XXX_ æ§½ä½çš„çŸ­è¯­ï¼Œä½ éœ€è¦åœ¨è¿™äº›æ§½ä½å¡«å…¥åˆé€‚çš„å•è¯ï¼Œè¦æ±‚å¡«å…¥çš„å•è¯èƒ½å¤Ÿè®©æ¯ä¸€ä¸ªçŸ­è¯­éƒ½æˆç«‹ã€‚
1. åˆ—ä¸¾ï¼š**å°½å¯èƒ½å¤šåœ°**åˆ—ä¸¾å¯èƒ½**æ»¡è¶³è¦æ±‚**çš„å•è¯ï¼Œå°†å®ƒä»¬ä½œä¸ºå€™é€‰è¯è¯­å¡«å…¥å€™é€‰é¡¹ï¼ˆCï¼‰å­—æ®µã€‚
2. æ£€æŸ¥ï¼šæ¥ç€ï¼Œè¯·å¯¹Cä¸­çš„å•è¯è¿›è¡Œé€ä¸ªè€ƒå¯Ÿï¼Œå°†è¯è¯­å¡«å…¥æ¯ä¸ªçŸ­è¯­ä¸­ï¼Œåˆ¤æ–­çŸ­è¯­æ˜¯å¦æ­£ç¡®ï¼ˆç”¨âœ…å’ŒâŒè¡¨ç¤ºï¼‰ã€‚å°†æ£€æŸ¥è¿‡ç¨‹å¡«å…¥æµ‹è¯•ï¼ˆTï¼‰å­—æ®µã€‚
3. å›ç­”ï¼šæ ¹æ®Tä¸­çš„ç»“æœï¼Œé€‰å‡ºæ‰€æœ‰çŸ­è¯­éƒ½æˆç«‹çš„å•è¯ï¼Œå¡«å…¥ç­”æ¡ˆï¼ˆAï¼‰å­—æ®µã€‚

**æ³¨æ„ï¼šè¯·å°½å¯èƒ½åœ¨ç¬¬ä¸€æ­¥å°±åˆ—ä¸¾æ­£ç¡®çš„å•è¯ï¼**`;

const default_reqFormat = `{"Q": ["æé«˜_XXX_", "å¾ˆé«˜çš„_XXX_"]}`;
const default_resFormat = `{ "C": ["æˆç»©", "è­¦æƒ•", "å±±è„‰", ...],
  "T:" {
    "æˆç»©": [["æé«˜æˆç»©", "âœ…"], ["å¾ˆé«˜çš„æˆç»©", "âœ…"]],
    "è­¦æƒ•": [["æé«˜è­¦æƒ•", "âœ…"], ["å¾ˆé«˜çš„è­¦æƒ•", "âœ…"]],
    "å±±è„‰": [["æé«˜å±±è„‰", "âŒ"], ["å¾ˆé«˜çš„å±±è„‰", "âœ…"]],
    ...
  },
  "A": ["æˆç»©", "è­¦æƒ•", ...] }`;
  const default_query = `{ "Q": ["è¿›è¡Œ_XXX_", "_XXX_èº«ä½“", "ä¿æŒ_XXX_çŠ¶æ€"] }`;


const { reactive, readonly, ref, toRefs, computed, onMounted, onUpdated } = Vue;
const MainApp = {
  setup() {
    const store = (localforage.createInstance({
      name: "my-ai-api-ui",
    }));
    const data = Vue.reactive({
      backendUrl: "",
      password: "",
      model: "gpt-3.5-turbo-1106", // gpt-4-1106-preview
      taskDesc: default_taskDesc,
      reqFormat: default_reqFormat,
      resFormat: default_resFormat,
      query: default_query,
      result: null,
      running: false,
      collapsed: false,
    });
    onMounted(() => {
      onMountedFn(store, data);
    });
    onUpdated(() => {
      onUpdatedFn(store, data);
    });

    function onRun() {
      onRunFn(data);
    }

    return {
      data,
      onRun,
    };
  },
};
const theApp = Vue.createApp(MainApp);
const app = theApp.mount("#app");
</script>
</body>
</html>